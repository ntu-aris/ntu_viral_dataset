{%- assign description = content | strip_html | split: " " | join: " " | escape | truncate: 150 -%}
{%- assign version = "2.0.0-beta" -%}

{%- assign rest = site.github.public_repositories | where: "html_url", site.github.repository_url | first -%}

{%- assign schema_date = page.date | default: site.time | date_to_xmlschema -%}
{%- assign schema_modi = site.time | date_to_xmlschema -%}
{%- assign schema_surl = page.url | absolute_url | xml_escape -%}

{% comment %} cdn {% endcomment %}
{%- if site.debug -%}
    {%- assign cdn = site.baseurl -%}
{%- else -%}
    {%- assign cdn = "https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@" | append: version -%}
{%- endif -%}

{%- include reset/site_pages.liquid %}

{% comment %} title {% endcomment %}
{%- case page.url -%}
    {%- when "/" -%}
        {%- assign title = site.title | append: " · " | append: site.description -%}
    {%- when "/search.html" -%}
        {%- assign title = __search   | append: " · " | append: site.title -%}
    {%- when "/404.html" -%}
        {%- assign title = __404      | append: " · " | append: site.title -%}
    {%- else -%}
        {%- assign title = page.title | default: page.url | append: " · " | append: site.title -%}
{%- endcase -%}

{% comment %} content {% endcomment %}
{%- assign content = content
    | replace: '’', "'"
    | replace: "“", '"'
    | replace: '”', '"'
    | replace: "highlighter-rouge", "highlighter-rouge notranslate" -%}


{% comment %} prev and next {% endcomment %}
{%- assign workdir_files = site_files | where_exp: "item", "item.dir == page.dir" -%}

{%- assign _index = 0 -%}
{%- for item in workdir_files %}
    {%- if item.url == page.url %}
        {%- assign _index = forloop.index -%}
    {%- endif %}
{%- endfor -%}

{%- for item in workdir_files -%}
    {%- assign _index_prev = _index | minus: 1 -%}
    {%- assign _index_next = _index | plus: 1 -%}
    {%- if forloop.index == _index_prev -%}
        {%- assign prev = item -%}
    {%- endif %}
    {%- if forloop.index == _index_next and page.url != page.dir -%}
        {%- assign next = item -%}
    {%- endif %}
{%- endfor -%}
